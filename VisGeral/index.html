<body>
	<head>
		<meta charset="UTF-8">
		<script src="http://d3js.org/d3.v3.min.js"></script>
		<script type="text/javascript" src="VisGeral.js"></script>
		<link type="text/css" rel="stylesheet" href="VisGeral.css"/>
	</head>
	<body>
		<div id="menus"></div>
		<script type="text/javascript">

			var vis = d3.select("body").append("svg")
		         .attr("width", 1000)
		         .attr("height",1000);



			  var tooltip = d3.select("body")
			      .append("div")
			      .style("fill", "grey")
			      .style("position", "absolute")
			      .style("z-index", "10")
			      .style("visibility", "hidden")
			      .text("a simple tooltip")
			      .style("font-size","15px");


		    var dataset = [];
		    var quantScale;
		    //var stateScale2;
		    var stateScale;
		    var gradeScale;
	      	var tamanhoy = 600;
			var tamanhox = 800;
		 
			var maxQuant = maxVal = minVal = minQuant = 0;

			d3.csv("tabelaVisGeral.csv",function(data){
				dataset = data ;

			var reordenar = function(subject){
	          console.log(subject);
	          	var dados = dataset;
				function compare2(a,b) {
					if (subject != "estado"){
						if (Number(a[subject]) < Number(b[subject]))
						    return -1;
						else if (Number(a[subject]) > Number(b[subject]))
						    return 1;
						else 
						    return 0;
					}
				
					else{
						if (a["estado"] < b["estado"])
						    return -1;
						else if (a["estado"] > b["estado"])
						    return 1;
						else 
						    return 0;
							
					}
				}
				dados.sort(compare2);
				return dados;
			};
				function compare(a,b) {
				  if (a["estado"] < b["estado"])
				    return -1;
				  else if (a["estado"] > b["estado"])
				    return 1;
				  else 
				    return 0;
				}

				dataset.sort(compare);
				console.log(dataset);
	      

	        var subjectMenu = d3.select("#menus").append("select").attr("id", "subjectMenu");
	        var prod = ["estado",
	                    "Linguagens",
	                    "Humanas", 
	                    "Natureza",
	                    "Redacao",
	                    "Matematica"];
	        subjectMenu.selectAll("option").data(prod).enter().append("option")
	          .attr("value", function (d) { return d })
	          .text(function (d) { return d });

	        var subject = prod[0];

	        d3.select("#subjectMenu").on("change", function() {
	          subject = d3.select("#subjectMenu").property("value") + "";
	          var dados = reordenar(subject)
	          VisGeralUpdate(dados);
	        });




			var subjects = ["Matematica",
			                    "Linguagens",
			                    "Humanas", 
			                    "Natureza",
			                    "Redacao"];
			

		    var sub = 0;
				maxVal = minVal = Number(dataset[0][subjects[0]]);
			for (sub= 0; sub< subjects.length; sub++){
				for (indice = 0; indice < dataset.length ; indice++){
					if (Number(dataset[indice][subjects[sub]]) > maxVal){
						maxVal = Number(dataset[indice][subjects[sub]]);
					};
					if (Number(dataset[indice][subjects[sub]]) < minVal){
						minVal = Number(dataset[indice][subjects[sub]]);
					};
					if (Number(dataset[indice].quantidade) > maxQuant){
						maxQuant = Number(dataset[indice].quantidade);
					};
					if (Number(dataset[indice].quantidade) < minQuant){
						minQuant = Number(dataset[indice].quantidade);
					};
				};
			};
			
			gradeScale = d3.scale.linear()
			    .domain([300, 600])
			    .range([tamanhoy, 0]);

			stateScale = d3.scale.linear()
			    .domain([-1, dataset.length])
			    .range([0,tamanhox]);



			quantScale = d3.scale.linear()
			    .domain([0, maxQuant*1.05])
			    .range([tamanhoy, 0]);
	        

	        VisGeral();
	      });




		</script>>
	</body>
</body>