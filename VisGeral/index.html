<body>
	<head>
		<meta charset="UTF-8">
		<script src="http://d3js.org/d3.v3.min.js"></script>
		<script type="text/javascript" src="VisGeral.js"></script>
		<link href="../bootstrap.min.css" rel="stylesheet">
		<link href="../template.css" rel="stylesheet">
		<link type="text/css" rel="stylesheet" href="VisGeral.css"/>
	</head>
	<body>



		<div class="container">
		    <div class="container" align="middle">
		    <div class="header clearfix">
		    	<div class="links">
			        <nav>
			        	<ul class="nav nav-pills pull-left">
			        		<li role="presentation" padding-top= "10px"><a href="../index.html"><img src="../imgs/enemEmDados.png" alt="Enem em Dados" height="40" border="0" ></a></li>
				            <li role="presentation"><a href="../VisMapa/index.html"><img src="../imgs/hexagono.png" alt="Vis Map" height="40" border="0"></a></li>
				            <li role="presentation" class="active"><a href="../VisGeral/index.html"><img src="../imgs/dispercao.png" alt="Dispersao" width="100" height="40" border="0"></a></li>
			            	<li role="presentation" ><a href="../VisIdade/index.html"><img src="../imgs/barras.png" alt="Vis Map"  height="40" border="0"></a></li>
						</ul>
					</nav>
				</div>
				<div class="logos">
					<nav>
				        <ul class="nav nav-pills pull-right">
					        <li role="presentation"><a href="#"><img src="../imgs/labvis.png" alt="Lab Vis"  height="30" border="0"></a></li>
					        <li role="presentation"><a href="#"><img src="../imgs/eba.png" alt="Eba" height="30" border="0"></a></li>
					        <li role="presentation"><a href="#"><img src="../imgs/logo_ufrj.png" alt="UFRJ" height="30" border="0"></a></li>
				        </ul>
			        </nav> 
			    </div>
			</div>
	    </div>

		<div id="menus"></div>
		<div align="center" class="visualizacao"></div>
		<script type="text/javascript">

			var vis = d3.select("div.visualizacao").append("svg")
		         .attr("width", "90%")
		         .attr("height",600);



			  var tooltip = d3.select("body")
			      .append("div")
			      .style("fill", "grey")
			      .style("position", "absolute")
			      .style("z-index", "10")
			      .style("visibility", "hidden")
			      .text("a simple tooltip")
			      .style("font-size","15px");


		    var dataset = [];
		    var quantScale;
		    //var stateScale2;
		    var stateScale;
		    var gradeScale;
	      	var tamanhoy = 500;
			var tamanhox = 600;
		 
			var maxQuant = maxVal = minVal = minQuant = 0;

			d3.csv("tabelaVisGeral.csv",function(data){
				dataset = data ;

			var reordenar = function(subject){
	          console.log(subject);
	          	var dados = dataset;
				function compare2(a,b) {
					if (subject != "estado"){
						if (Number(a[subject]) < Number(b[subject]))
						    return -1;
						else if (Number(a[subject]) > Number(b[subject]))
						    return 1;
						else 
						    return 0;
					}
				
					else{
						if (a["estado"] < b["estado"])
						    return -1;
						else if (a["estado"] > b["estado"])
						    return 1;
						else 
						    return 0;
							
					}
				}
				dados.sort(compare2);
				return dados;
			};
				function compare(a,b) {
				  if (a["estado"] < b["estado"])
				    return -1;
				  else if (a["estado"] > b["estado"])
				    return 1;
				  else 
				    return 0;
				}

				dataset.sort(compare);
				console.log(dataset);
	      
/*
	        var subjectMenu = d3.select("#menus").append("select").attr("id", "subjectMenu");
	        var prod = ["estado",
	                    "Linguagens",
	                    "Humanas", 
	                    "Natureza",
	                    "Redacao",
	                    "Matematica"];
	        subjectMenu.selectAll("option").data(prod).enter().append("option")
	          .attr("value", function (d) { return d })
	          .text(function (d) { return d });

	        var subject = prod[0];

	        d3.select("#subjectMenu").on("change", function() {
	          subject = d3.select("#subjectMenu").property("value") + "";
	          var dados = reordenar(subject);
	          VisGeralUpdate(dados, subject);
	        });

*/
			var prod = ["estado",
	                    "Linguagens",
	                    "Humanas", 
	                    "Natureza",
	                    "Redacao",
	                    "Matematica"];

			menu = vis.append("g")
					.attr("class", "menu")
					.attr("transform",function(d,i){return "translate(-800,50)";});

			menu.selectAll(".selected")
				.data([0])
				.enter()
				.append("rect")
				.attr("class", "selected")
				.attr("width", 200)
				.attr("height", 30);

				menu.selectAll(".options")
				.data(prod)
				.enter()
				.append("text")
				.text( function (d) { return "" + d; })
		        .attr("x", function(d, i) { return 1000 -60; })
 		        .attr("y", function(d, i){ return (i + 1) * (tamanhoy*2/3)/prod.length;})
 		        .attr("class", "options")
 		        .on("click", function(d, i){
	 		       var dados = reordenar(d);
		           VisGeralUpdate(dados, d);
		           d3.selectAll(".options").style("font-weight","normal");
		           d3.select(this).style("font-weight","bold"); 	
				
				vis.selectAll(".selected")
					.transition()
					.attr("y", function(){ return (i + 1) * (tamanhoy*2/3)/prod.length - 22;})
					.duration(1000);

 		        });



			var subjects = ["Matematica",
			                    "Linguagens",
			                    "Humanas", 
			                    "Natureza",
			                    "Redacao"];
			

		    var sub = 0;
				maxVal = minVal = Number(dataset[0][subjects[0]]);
			for (sub= 0; sub< subjects.length; sub++){
				for (indice = 0; indice < dataset.length ; indice++){
					if (Number(dataset[indice][subjects[sub]]) > maxVal){
						maxVal = Number(dataset[indice][subjects[sub]]);
					};
					if (Number(dataset[indice][subjects[sub]]) < minVal){
						minVal = Number(dataset[indice][subjects[sub]]);
					};
					if (Number(dataset[indice].quantidade) > maxQuant){
						maxQuant = Number(dataset[indice].quantidade);
					};
					if (Number(dataset[indice].quantidade) < minQuant){
						minQuant = Number(dataset[indice].quantidade);
					};
				};
			};
			
			gradeScale = d3.scale.linear()
			    .domain([minVal * 0.95, maxVal * 1.03])
			    .range([tamanhoy, 0]);

			stateScale = d3.scale.linear()
			    .domain([-1, dataset.length])
			    .range([0,tamanhox]);



			quantScale = d3.scale.linear()
			    .domain([0, maxQuant*1.05])
			    .range([tamanhoy, 0]);
	        
			vis.selectAll(".options")
				.filter(function(d){
		    				return d == "estado";
		    				})
				.style("font-weight","bold");
				vis.selectAll(".selected")
					.attr("x", 900)
					.attr("y", function(d, i){ return (i + 1) * (tamanhoy*2/3)/prod.length - 22;});
	        VisGeral();
	      });




		</script>
	</body>
</body>